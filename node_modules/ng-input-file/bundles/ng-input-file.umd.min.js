!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("@angular/forms"),require("@angular/common"),require("@angular/material"),require("@angular/material/icon")):"function"==typeof define&&define.amd?define("ng-input-file",["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators","@angular/forms","@angular/common","@angular/material","@angular/material/icon"],t):t((e=e||self)["ng-input-file"]={},e.ng.core,e.ng.common.http,e.rxjs,e.rxjs.operators,e.ng.forms,e.ng.common,e.ng.material,e.ng.material.icon)}(this,function(e,t,i,o,n,r,l,a,s){"use strict";function p(e,t){var i,o,n,r,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(n=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[0,n.value]),r[0]){case 0:case 1:n=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,o=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(!(n=(n=l.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){l.label=r[1];break}if(6===r[0]&&l.label<n[1]){l.label=n[1],n=r;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(r);break}n[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(a){r=[6,a],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}var c="https://apis.google.com/js/api.js?onload=loadPicker",u=["https://www.googleapis.com/auth/drive"],h=function(){function e(e){var i=this;this.http=e,this.isDevMode=t.isDevMode(),this.file$=new o.Subject,this.selectedFile=this.file$.asObservable(),this.pickerApiLoaded=!1,this.googleApiUrl=c,this.googleApiLoaded=!1,this.log=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return e&&i.isDevMode&&console.log(e,t)},this.log("'google-drive.service'"),this.onAuthApiLoad=this.onAuthApiLoad.bind(this),this.onPickerApiLoad=this.onPickerApiLoad.bind(this),this.handleAuthResult=this.handleAuthResult.bind(this),this.pickerCallback=this.pickerCallback.bind(this)}return e.prototype.setDevMode=function(){this.isDevMode=!0},e.prototype.ngOnDestroy=function(){},e.prototype.init=function(e){this.config=e},e.prototype.loadScript=function(){var e=this;if(this.config)return new Promise(function(t,i){if(e.googleApiLoaded)t("already loaded");else{var o=document.createElement("script");o.type="text/javascript",o.src=e.googleApiUrl,o.onload=function(){e.googleApiLoaded=!0,t("loaded")},o.onerror=function(e){return t("failed to load")},document.getElementsByTagName("head")[0].appendChild(o)}})},e.prototype.loadPicker=function(){this.config&&(this.pickerApiLoaded=!1,this.oauthToken=null,this.doLoadPicker())},e.prototype.doLoadPicker=function(){gapi.load("auth",{callback:this.onAuthApiLoad}),gapi.load("picker",{callback:this.onPickerApiLoad})},e.prototype.onAuthApiLoad=function(){gapi.auth.authorize({client_id:this.config.clientId,scope:u,immediate:!1},this.handleAuthResult)},e.prototype.onPickerApiLoad=function(){this.pickerApiLoaded=!0,this.createPicker()},e.prototype.handleAuthResult=function(e){e&&!e.error&&(this.oauthToken=e.access_token,this.createPicker(),this.log("handleAuthResult",e))},e.prototype.createPicker=function(){if(this.pickerApiLoaded&&this.oauthToken){var e=window.location.protocol+"//"+window.location.host;this.log("createPicker origin '"+e+"'");var t=new google.picker.View(google.picker.ViewId.DOCS);t.setMimeTypes("image/png,image/jpeg,image/jpg"),(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).setAppId(this.config.appId).setOAuthToken(this.oauthToken).setOrigin(e).addView(t).addView(new google.picker.DocsUploadView).setCallback(this.pickerCallback).build().setVisible(!0)}},e.prototype.pickerCallback=function(e){return t=this,i=void 0,r=function(){var t,i,o,r,l=this;return p(this,function(a){switch(a.label){case 0:return e.action!=google.picker.Action.PICKED?[3,2]:(t=e.docs[0],i=t.id,o=gapi.auth.getToken().access_token,this.log("The user selected",i,o,t),[4,this.getFile(i,o).pipe(n.take(1)).forEach(function(e){r=new File([e],t.name,{type:e.type}),l.file$.next(r)})]);case 1:a.sent(),a.label=2;case 2:return[2]}})},new((o=void 0)||(o=Promise))(function(e,n){function l(e){try{s(r.next(e))}catch(t){n(t)}}function a(e){try{s(r["throw"](e))}catch(t){n(t)}}function s(t){t.done?e(t.value):new o(function(e){e(t.value)}).then(l,a)}s((r=r.apply(t,i||[])).next())});var t,i,o,r},e.prototype.getFile=function(e,t){var o="https://www.googleapis.com/drive/v3/files/"+e+"?alt=media";return this.http.get(o,{headers:new i.HttpHeaders({Authorization:"Bearer "+t}),responseType:"blob"})},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:i.HttpClient}]},e}(),d="",g="image/*, video/*",f=function(){function e(e){var i=this;this.service=e,this.file=new r.FormControl({value:d,disabled:!0}),this.accept=g,this.files=new t.EventEmitter,this.service.selectedFile.subscribe(function(e){return i.googleFileChanged(e)}),this.drop=this.drop.bind(this),this.fileDropped=this.fileDropped.bind(this)}return Object.defineProperty(e.prototype,"filename",{get:function(){return this.file.value},set:function(e){this.file.setValue(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.dropbox&&(this.dropbox.addEventListener("dragenter",this.dragenter,!1),this.dropbox.addEventListener("dragover",this.dragover,!1),this.dropbox.addEventListener("drop",this.drop,!1)),this.service.log("NgInputFileComponent",this.dropbox)},e.prototype.dragenter=function(e){e.stopPropagation(),e.preventDefault()},e.prototype.dragover=function(e){e.stopPropagation(),e.preventDefault()},e.prototype.drop=function(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;this.fileDropped(t)},e.prototype.fileDropped=function(e){if(e&&0!==e.length){var t=e.item(0);this.service.log("fileDropped '"+t.name+"'",t),this.filename!==t.name&&(this.filename=t.name,this.googleFile=null,this.emitFiles(e))}},e.prototype.fileChanged=function(){var e=d;if(this.getFiles().length>0){var t=this.getFiles().item(0);t&&(e=t.name)}this.filename!==e&&(this.filename=e,this.googleFile=null,this.emitFiles())},e.prototype.googleFileChanged=function(e){this.service.log("googleFileChanged '"+e.name+"'",e),this.googleFile&&this.googleFile.name===e.name&&this.googleFile.size===e.size||(this.filename=e.name,this.googleFile=e,this.emitFiles())},e.prototype.googleDrivePick=function(){var e=this;this.service.loadScript().then(function(t){return e.service.loadPicker()})["catch"](function(e){return console.error("googleDrivePick",e)})},e.prototype.clear=function(){this.getFileInput().value=d,this.googleFile=null,this.filename=d},e.prototype.remove=function(){this.clear(),this.emitFiles()},e.prototype.emitFiles=function(e){var t=e||(this.googleFile?[this.googleFile]:this.getFiles());this.files.emit({files:t})},e.prototype.getFileInput=function(){return this.inputEl.nativeElement},e.prototype.getFiles=function(){return this.getFileInput().files},e.decorators=[{type:t.Component,args:[{selector:"input-file",template:'\n<div class="box">\n  <div class="input-file" style="width:93%">\n    <mat-form-field style="width:100%" (click)="inputEl.click()">\n      <i matPrefix>\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M2 12.5C2 9.46 4.46 7 7.5 7H18c2.21 0 4 1.79 4 4s-1.79 4-4 4H9.5C8.12 15 7 13.88 7 12.5S8.12 10 9.5 10H17v2H9.41c-.55 0-.55 1 0 1H18c1.1 0 2-.9 2-2s-.9-2-2-2H7.5C5.57 9 4 10.57 4 12.5S5.57 16 7.5 16H17v2H7.5C4.46 18 2 15.54 2 12.5z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>\n      </i>\n      <input matInput placeholder="Choose file" [formControl]="file">\n    </mat-form-field>\n    <input type="file" [attr.accept]="accept" (change)="fileChanged()" #inputEl>\n  </div>\n  <i class="icon" *ngIf="service.config" (click)="googleDrivePick()">\n    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48" version="1.1" width="24px" height="24px"><g id="surface1"><path style=" fill:#FFC107;" d="M 17 6 L 31 6 L 45 30 L 31 30 Z "/><path style=" fill:#1976D2;" d="M 9.875 42 L 16.9375 30 L 45 30 L 38 42 Z "/><path style=" fill:#4CAF50;" d="M 3 30.125 L 9.875 42 L 24 18 L 17 6 Z "/></g></svg>\n  </i>\n  <i class="icon" *ngIf="filename" (click)="remove()">\n    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>\n  </i>\n</div>\n  ',styles:["\n.box {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\nmat-form-field, i.icon {\n  cursor: pointer;\n}\ninput[type=file] {\n  display: none;\n}\ni[matPrefix] {\n  padding-right: 5px;\n}\ni.icon {\n  padding-bottom: 12px;\n}\n  "]}]}],e.ctorParameters=function(){return[{type:h}]},e.propDecorators={accept:[{type:t.Input}],files:[{type:t.Output}],inputEl:[{type:t.ViewChild,args:["inputEl"]}],dropbox:[{type:t.Input}]},e}(),m=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[l.CommonModule,i.HttpClientModule,r.ReactiveFormsModule,a.MatButtonModule,a.MatInputModule,s.MatIconModule],providers:[h],declarations:[f],exports:[f]}]}],e}();e.GoogleDriveService=h,e.NgInputFileComponent=f,e.NgInputFileModule=m,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng-input-file.umd.min.js.map