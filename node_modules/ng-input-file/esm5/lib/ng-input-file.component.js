/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { FormControl } from '@angular/forms';
import { GoogleDriveService } from './google-drive.service';
/** @type {?} */
var NO_FILE = '';
/** @type {?} */
var ACCEPT_DEFAULT = 'image/*, video/*';
var NgInputFileComponent = /** @class */ (function () {
    function NgInputFileComponent(service) {
        var _this = this;
        this.service = service;
        this.file = new FormControl({ value: NO_FILE, disabled: true });
        this.accept = ACCEPT_DEFAULT;
        this.files = new EventEmitter();
        this.service.selectedFile.subscribe((/**
         * @param {?} file
         * @return {?}
         */
        function (file) { return _this.googleFileChanged(file); }));
        this.drop = this.drop.bind(this);
        this.fileDropped = this.fileDropped.bind(this);
    }
    Object.defineProperty(NgInputFileComponent.prototype, "filename", {
        get: /**
         * @return {?}
         */
        function () { return this.file.value; },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) { this.file.setValue(value); },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    NgInputFileComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (this.dropbox) {
            this.dropbox.addEventListener('dragenter', this.dragenter, false);
            this.dropbox.addEventListener('dragover', this.dragover, false);
            this.dropbox.addEventListener('drop', this.drop, false);
        }
        this.service.log('NgInputFileComponent', this.dropbox);
    };
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    NgInputFileComponent.prototype.dragenter = /**
     * @private
     * @param {?} e
     * @return {?}
     */
    function (e) {
        e.stopPropagation();
        e.preventDefault();
    };
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    NgInputFileComponent.prototype.dragover = /**
     * @private
     * @param {?} e
     * @return {?}
     */
    function (e) {
        e.stopPropagation();
        e.preventDefault();
    };
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    NgInputFileComponent.prototype.drop = /**
     * @private
     * @param {?} e
     * @return {?}
     */
    function (e) {
        e.stopPropagation();
        e.preventDefault();
        /** @type {?} */
        var dt = e.dataTransfer;
        /** @type {?} */
        var files = dt.files;
        this.fileDropped(files);
    };
    /**
     * @private
     * @param {?} files
     * @return {?}
     */
    NgInputFileComponent.prototype.fileDropped = /**
     * @private
     * @param {?} files
     * @return {?}
     */
    function (files) {
        if (!files || files.length === 0)
            return;
        /** @type {?} */
        var file = files.item(0);
        this.service.log("fileDropped '" + file.name + "'", file);
        if (this.filename === file.name)
            return;
        // got new file drag-and-dropped from local device
        this.filename = file.name;
        this.googleFile = null;
        this.emitFiles(files);
    };
    /**
     * @return {?}
     */
    NgInputFileComponent.prototype.fileChanged = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var filename = NO_FILE;
        if (this.getFiles().length > 0) {
            /** @type {?} */
            var file = this.getFiles().item(0);
            if (file)
                filename = file.name;
        }
        if (this.filename === filename)
            return;
        // got new file chosen from local device
        this.filename = filename;
        this.googleFile = null;
        this.emitFiles();
    };
    /**
     * @param {?} file
     * @return {?}
     */
    NgInputFileComponent.prototype.googleFileChanged = /**
     * @param {?} file
     * @return {?}
     */
    function (file) {
        this.service.log("googleFileChanged '" + file.name + "'", file);
        if (this.googleFile &&
            this.googleFile.name === file.name &&
            this.googleFile.size === file.size)
            return;
        // got new file from google drive
        this.filename = file.name;
        this.googleFile = file;
        this.emitFiles();
    };
    /**
     * @return {?}
     */
    NgInputFileComponent.prototype.googleDrivePick = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.service.loadScript()
            .then((/**
         * @param {?} data
         * @return {?}
         */
        function (data) { return _this.service.loadPicker(); }))
            .catch((/**
         * @param {?} error
         * @return {?}
         */
        function (error) { return console.error('googleDrivePick', error); }));
    };
    /**
     * @return {?}
     */
    NgInputFileComponent.prototype.clear = /**
     * @return {?}
     */
    function () {
        this.getFileInput().value = NO_FILE;
        this.googleFile = null;
        this.filename = NO_FILE;
    };
    /**
     * @return {?}
     */
    NgInputFileComponent.prototype.remove = /**
     * @return {?}
     */
    function () {
        this.clear();
        this.emitFiles();
    };
    /**
     * @private
     * @param {?=} droppedFiles
     * @return {?}
     */
    NgInputFileComponent.prototype.emitFiles = /**
     * @private
     * @param {?=} droppedFiles
     * @return {?}
     */
    function (droppedFiles) {
        /** @type {?} */
        var files = droppedFiles || (this.googleFile ? [this.googleFile] : this.getFiles());
        this.files.emit({ files: files });
    };
    /**
     * @private
     * @return {?}
     */
    NgInputFileComponent.prototype.getFileInput = /**
     * @private
     * @return {?}
     */
    function () {
        return this.inputEl.nativeElement;
    };
    /**
     * @private
     * @return {?}
     */
    NgInputFileComponent.prototype.getFiles = /**
     * @private
     * @return {?}
     */
    function () {
        return this.getFileInput().files;
    };
    NgInputFileComponent.decorators = [
        { type: Component, args: [{
                    selector: 'input-file',
                    template: "\n<div class=\"box\">\n  <div class=\"input-file\" style=\"width:93%\">\n    <mat-form-field style=\"width:100%\" (click)=\"inputEl.click()\">\n      <i matPrefix>\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M2 12.5C2 9.46 4.46 7 7.5 7H18c2.21 0 4 1.79 4 4s-1.79 4-4 4H9.5C8.12 15 7 13.88 7 12.5S8.12 10 9.5 10H17v2H9.41c-.55 0-.55 1 0 1H18c1.1 0 2-.9 2-2s-.9-2-2-2H7.5C5.57 9 4 10.57 4 12.5S5.57 16 7.5 16H17v2H7.5C4.46 18 2 15.54 2 12.5z\"/><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/></svg>\n      </i>\n      <input matInput placeholder=\"Choose file\" [formControl]=\"file\">\n    </mat-form-field>\n    <input type=\"file\" [attr.accept]=\"accept\" (change)=\"fileChanged()\" #inputEl>\n  </div>\n  <i class=\"icon\" *ngIf=\"service.config\" (click)=\"googleDrivePick()\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 48 48\" version=\"1.1\" width=\"24px\" height=\"24px\"><g id=\"surface1\"><path style=\" fill:#FFC107;\" d=\"M 17 6 L 31 6 L 45 30 L 31 30 Z \"/><path style=\" fill:#1976D2;\" d=\"M 9.875 42 L 16.9375 30 L 45 30 L 38 42 Z \"/><path style=\" fill:#4CAF50;\" d=\"M 3 30.125 L 9.875 42 L 24 18 L 17 6 Z \"/></g></svg>\n  </i>\n  <i class=\"icon\" *ngIf=\"filename\" (click)=\"remove()\">\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4z\"/><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/></svg>\n  </i>\n</div>\n  ",
                    styles: ["\n.box {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\nmat-form-field, i.icon {\n  cursor: pointer;\n}\ninput[type=file] {\n  display: none;\n}\ni[matPrefix] {\n  padding-right: 5px;\n}\ni.icon {\n  padding-bottom: 12px;\n}\n  "]
                }] }
    ];
    /** @nocollapse */
    NgInputFileComponent.ctorParameters = function () { return [
        { type: GoogleDriveService }
    ]; };
    NgInputFileComponent.propDecorators = {
        accept: [{ type: Input }],
        files: [{ type: Output }],
        inputEl: [{ type: ViewChild, args: ['inputEl',] }],
        dropbox: [{ type: Input }]
    };
    return NgInputFileComponent;
}());
export { NgInputFileComponent };
if (false) {
    /** @type {?} */
    NgInputFileComponent.prototype.file;
    /** @type {?} */
    NgInputFileComponent.prototype.accept;
    /** @type {?} */
    NgInputFileComponent.prototype.files;
    /**
     * @type {?}
     * @private
     */
    NgInputFileComponent.prototype.inputEl;
    /**
     * @type {?}
     * @private
     */
    NgInputFileComponent.prototype.googleFile;
    /** @type {?} */
    NgInputFileComponent.prototype.dropbox;
    /** @type {?} */
    NgInputFileComponent.prototype.service;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctaW5wdXQtZmlsZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1pbnB1dC1maWxlLyIsInNvdXJjZXMiOlsibGliL25nLWlucHV0LWZpbGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdEcsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDOztJQUV0RCxPQUFPLEdBQUcsRUFBRTs7SUFDWixjQUFjLEdBQUcsa0JBQWtCO0FBRXpDO0lBc0RFLDhCQUFtQixPQUEyQjtRQUE5QyxpQkFLQztRQUxrQixZQUFPLEdBQVAsT0FBTyxDQUFvQjtRQVo5QyxTQUFJLEdBQUcsSUFBSSxXQUFXLENBQUMsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBSWhELFdBQU0sR0FBRyxjQUFjLENBQUM7UUFDdkIsVUFBSyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBUXRELElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFBLElBQUksSUFBSSxPQUFBLEtBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBNUIsQ0FBNEIsRUFBQyxDQUFDO1FBRTFFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBaEJELHNCQUFJLDBDQUFROzs7O1FBQVosY0FBaUIs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Ozs7SUFBakIsVUFBa0IsWUFBYTs7WUFDdkIsS0FBSyxHQUFHLFlBQVksSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDckYsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUNwQyxDQUFDOzs7OztJQUVPLDJDQUFZOzs7O0lBQXBCO1FBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQztJQUNwQyxDQUFDOzs7OztJQUVPLHVDQUFROzs7O0lBQWhCO1FBQ0UsT0FBTyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsS0FBSyxDQUFDO0lBQ25DLENBQUM7O2dCQW5LRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLFlBQVk7b0JBQ3RCLFFBQVEsRUFBRSxta0RBa0JUOzZCQUNRLHdRQWtCUjtpQkFDRjs7OztnQkE3Q1Esa0JBQWtCOzs7eUJBbUR4QixLQUFLO3dCQUNMLE1BQU07MEJBQ04sU0FBUyxTQUFDLFNBQVM7MEJBSW5CLEtBQUs7O0lBZ0hSLDJCQUFDO0NBQUEsQUFwS0QsSUFvS0M7U0EzSFksb0JBQW9COzs7SUFDL0Isb0NBQXlEOztJQUl6RCxzQ0FBaUM7O0lBQ2pDLHFDQUF3RDs7Ozs7SUFDeEQsdUNBQzRCOzs7OztJQUM1QiwwQ0FBeUI7O0lBRXpCLHVDQUFzQjs7SUFFVix1Q0FBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRm9ybUNvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEdvb2dsZURyaXZlU2VydmljZSB9IGZyb20gJy4vZ29vZ2xlLWRyaXZlLnNlcnZpY2UnO1xyXG5cclxuY29uc3QgTk9fRklMRSA9ICcnO1xyXG5jb25zdCBBQ0NFUFRfREVGQVVMVCA9ICdpbWFnZS8qLCB2aWRlby8qJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnaW5wdXQtZmlsZScsXHJcbiAgdGVtcGxhdGU6IGBcclxuPGRpdiBjbGFzcz1cImJveFwiPlxyXG4gIDxkaXYgY2xhc3M9XCJpbnB1dC1maWxlXCIgc3R5bGU9XCJ3aWR0aDo5MyVcIj5cclxuICAgIDxtYXQtZm9ybS1maWVsZCBzdHlsZT1cIndpZHRoOjEwMCVcIiAoY2xpY2spPVwiaW5wdXRFbC5jbGljaygpXCI+XHJcbiAgICAgIDxpIG1hdFByZWZpeD5cclxuICAgICAgICA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjI0XCIgaGVpZ2h0PVwiMjRcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCI+PHBhdGggZD1cIk0yIDEyLjVDMiA5LjQ2IDQuNDYgNyA3LjUgN0gxOGMyLjIxIDAgNCAxLjc5IDQgNHMtMS43OSA0LTQgNEg5LjVDOC4xMiAxNSA3IDEzLjg4IDcgMTIuNVM4LjEyIDEwIDkuNSAxMEgxN3YySDkuNDFjLS41NSAwLS41NSAxIDAgMUgxOGMxLjEgMCAyLS45IDItMnMtLjktMi0yLTJINy41QzUuNTcgOSA0IDEwLjU3IDQgMTIuNVM1LjU3IDE2IDcuNSAxNkgxN3YySDcuNUM0LjQ2IDE4IDIgMTUuNTQgMiAxMi41elwiLz48cGF0aCBmaWxsPVwibm9uZVwiIGQ9XCJNMCAwaDI0djI0SDBWMHpcIi8+PC9zdmc+XHJcbiAgICAgIDwvaT5cclxuICAgICAgPGlucHV0IG1hdElucHV0IHBsYWNlaG9sZGVyPVwiQ2hvb3NlIGZpbGVcIiBbZm9ybUNvbnRyb2xdPVwiZmlsZVwiPlxyXG4gICAgPC9tYXQtZm9ybS1maWVsZD5cclxuICAgIDxpbnB1dCB0eXBlPVwiZmlsZVwiIFthdHRyLmFjY2VwdF09XCJhY2NlcHRcIiAoY2hhbmdlKT1cImZpbGVDaGFuZ2VkKClcIiAjaW5wdXRFbD5cclxuICA8L2Rpdj5cclxuICA8aSBjbGFzcz1cImljb25cIiAqbmdJZj1cInNlcnZpY2UuY29uZmlnXCIgKGNsaWNrKT1cImdvb2dsZURyaXZlUGljaygpXCI+XHJcbiAgICA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIiB2aWV3Qm94PVwiMCAwIDQ4IDQ4XCIgdmVyc2lvbj1cIjEuMVwiIHdpZHRoPVwiMjRweFwiIGhlaWdodD1cIjI0cHhcIj48ZyBpZD1cInN1cmZhY2UxXCI+PHBhdGggc3R5bGU9XCIgZmlsbDojRkZDMTA3O1wiIGQ9XCJNIDE3IDYgTCAzMSA2IEwgNDUgMzAgTCAzMSAzMCBaIFwiLz48cGF0aCBzdHlsZT1cIiBmaWxsOiMxOTc2RDI7XCIgZD1cIk0gOS44NzUgNDIgTCAxNi45Mzc1IDMwIEwgNDUgMzAgTCAzOCA0MiBaIFwiLz48cGF0aCBzdHlsZT1cIiBmaWxsOiM0Q0FGNTA7XCIgZD1cIk0gMyAzMC4xMjUgTCA5Ljg3NSA0MiBMIDI0IDE4IEwgMTcgNiBaIFwiLz48L2c+PC9zdmc+XHJcbiAgPC9pPlxyXG4gIDxpIGNsYXNzPVwiaWNvblwiICpuZ0lmPVwiZmlsZW5hbWVcIiAoY2xpY2spPVwicmVtb3ZlKClcIj5cclxuICAgIDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMjRcIiBoZWlnaHQ9XCIyNFwiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIj48cGF0aCBkPVwiTTYgMTljMCAxLjEuOSAyIDIgMmg4YzEuMSAwIDItLjkgMi0yVjdINnYxMnpNOCA5aDh2MTBIOFY5em03LjUtNWwtMS0xaC01bC0xIDFINXYyaDE0VjR6XCIvPjxwYXRoIGZpbGw9XCJub25lXCIgZD1cIk0wIDBoMjR2MjRIMFYwelwiLz48L3N2Zz5cclxuICA8L2k+XHJcbjwvZGl2PlxyXG4gIGAsXHJcbiAgc3R5bGVzOiBbYFxyXG4uYm94IHtcclxuICBkaXNwbGF5OiBmbGV4O1xyXG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XHJcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xyXG59XHJcbm1hdC1mb3JtLWZpZWxkLCBpLmljb24ge1xyXG4gIGN1cnNvcjogcG9pbnRlcjtcclxufVxyXG5pbnB1dFt0eXBlPWZpbGVdIHtcclxuICBkaXNwbGF5OiBub25lO1xyXG59XHJcbmlbbWF0UHJlZml4XSB7XHJcbiAgcGFkZGluZy1yaWdodDogNXB4O1xyXG59XHJcbmkuaWNvbiB7XHJcbiAgcGFkZGluZy1ib3R0b206IDEycHg7XHJcbn1cclxuICBgXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIE5nSW5wdXRGaWxlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBmaWxlID0gbmV3IEZvcm1Db250cm9sKHt2YWx1ZTogTk9fRklMRSwgZGlzYWJsZWQ6IHRydWV9KTtcclxuICBnZXQgZmlsZW5hbWUoKSB7IHJldHVybiB0aGlzLmZpbGUudmFsdWU7IH1cclxuICBzZXQgZmlsZW5hbWUodmFsdWUpIHsgdGhpcy5maWxlLnNldFZhbHVlKHZhbHVlKTsgfVxyXG5cclxuICBASW5wdXQoKSBhY2NlcHQgPSBBQ0NFUFRfREVGQVVMVDtcclxuICBAT3V0cHV0KCkgZmlsZXM6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBWaWV3Q2hpbGQoJ2lucHV0RWwnKVxyXG4gIHByaXZhdGUgaW5wdXRFbDogRWxlbWVudFJlZjtcclxuICBwcml2YXRlIGdvb2dsZUZpbGU6IEZpbGU7XHJcblxyXG4gIEBJbnB1dCgpIGRyb3Bib3g6IGFueTsgLy8gbmF0aXZlRWxlbWVudFxyXG5cclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgc2VydmljZTogR29vZ2xlRHJpdmVTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLnNlcnZpY2Uuc2VsZWN0ZWRGaWxlLnN1YnNjcmliZShmaWxlID0+IHRoaXMuZ29vZ2xlRmlsZUNoYW5nZWQoZmlsZSkpO1xyXG5cclxuICAgIHRoaXMuZHJvcCA9IHRoaXMuZHJvcC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5maWxlRHJvcHBlZCA9IHRoaXMuZmlsZURyb3BwZWQuYmluZCh0aGlzKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgaWYgKHRoaXMuZHJvcGJveCkge1xyXG4gICAgICB0aGlzLmRyb3Bib3guYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VudGVyJywgdGhpcy5kcmFnZW50ZXIsIGZhbHNlKTtcclxuICAgICAgdGhpcy5kcm9wYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnb3ZlciwgZmFsc2UpO1xyXG4gICAgICB0aGlzLmRyb3Bib3guYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJvcCwgZmFsc2UpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zZXJ2aWNlLmxvZygnTmdJbnB1dEZpbGVDb21wb25lbnQnLCB0aGlzLmRyb3Bib3gpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkcmFnZW50ZXIoZSkge1xyXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZHJhZ292ZXIoZSkge1xyXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZHJvcChlKSB7XHJcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIHZhciBkdCA9IGUuZGF0YVRyYW5zZmVyO1xyXG4gICAgdmFyIGZpbGVzID0gZHQuZmlsZXM7XHJcblxyXG4gICAgdGhpcy5maWxlRHJvcHBlZChmaWxlcyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGZpbGVEcm9wcGVkKGZpbGVzKSB7XHJcbiAgICBpZiAoIWZpbGVzIHx8IGZpbGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IGZpbGUgPSBmaWxlcy5pdGVtKDApO1xyXG5cclxuICAgIHRoaXMuc2VydmljZS5sb2coYGZpbGVEcm9wcGVkICcke2ZpbGUubmFtZX0nYCwgZmlsZSk7XHJcblxyXG4gICAgaWYgKHRoaXMuZmlsZW5hbWUgPT09IGZpbGUubmFtZSkgcmV0dXJuO1xyXG5cclxuICAgIC8vIGdvdCBuZXcgZmlsZSBkcmFnLWFuZC1kcm9wcGVkIGZyb20gbG9jYWwgZGV2aWNlXHJcbiAgICB0aGlzLmZpbGVuYW1lID0gZmlsZS5uYW1lO1xyXG4gICAgdGhpcy5nb29nbGVGaWxlID0gbnVsbDtcclxuICAgIHRoaXMuZW1pdEZpbGVzKGZpbGVzKTtcclxuICB9XHJcblxyXG5cclxuICBmaWxlQ2hhbmdlZCgpIHtcclxuICAgIGxldCBmaWxlbmFtZSA9IE5PX0ZJTEU7XHJcbiAgICBpZiAodGhpcy5nZXRGaWxlcygpLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgZmlsZSA9IHRoaXMuZ2V0RmlsZXMoKS5pdGVtKDApO1xyXG4gICAgICBpZiAoZmlsZSkgZmlsZW5hbWUgPSBmaWxlLm5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuZmlsZW5hbWUgPT09IGZpbGVuYW1lKSByZXR1cm47XHJcblxyXG4gICAgLy8gZ290IG5ldyBmaWxlIGNob3NlbiBmcm9tIGxvY2FsIGRldmljZVxyXG4gICAgdGhpcy5maWxlbmFtZSA9IGZpbGVuYW1lO1xyXG4gICAgdGhpcy5nb29nbGVGaWxlID0gbnVsbDtcclxuICAgIHRoaXMuZW1pdEZpbGVzKCk7XHJcbiAgfVxyXG5cclxuICBnb29nbGVGaWxlQ2hhbmdlZChmaWxlKSB7XHJcbiAgICB0aGlzLnNlcnZpY2UubG9nKGBnb29nbGVGaWxlQ2hhbmdlZCAnJHtmaWxlLm5hbWV9J2AsIGZpbGUpO1xyXG5cclxuICAgIGlmICh0aGlzLmdvb2dsZUZpbGUgJiZcclxuICAgICAgdGhpcy5nb29nbGVGaWxlLm5hbWUgPT09IGZpbGUubmFtZSAmJlxyXG4gICAgICB0aGlzLmdvb2dsZUZpbGUuc2l6ZSA9PT0gZmlsZS5zaXplKVxyXG4gICAgICByZXR1cm47XHJcblxyXG4gICAgLy8gZ290IG5ldyBmaWxlIGZyb20gZ29vZ2xlIGRyaXZlXHJcbiAgICB0aGlzLmZpbGVuYW1lID0gZmlsZS5uYW1lO1xyXG4gICAgdGhpcy5nb29nbGVGaWxlID0gZmlsZTtcclxuICAgIHRoaXMuZW1pdEZpbGVzKCk7XHJcbiAgfVxyXG5cclxuICBnb29nbGVEcml2ZVBpY2soKSB7XHJcbiAgICB0aGlzLnNlcnZpY2UubG9hZFNjcmlwdCgpXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gdGhpcy5zZXJ2aWNlLmxvYWRQaWNrZXIoKSlcclxuICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoJ2dvb2dsZURyaXZlUGljaycsIGVycm9yKSk7XHJcbiAgfVxyXG5cclxuICBjbGVhcigpIHtcclxuICAgIHRoaXMuZ2V0RmlsZUlucHV0KCkudmFsdWUgPSBOT19GSUxFO1xyXG4gICAgdGhpcy5nb29nbGVGaWxlID0gbnVsbDtcclxuICAgIHRoaXMuZmlsZW5hbWUgPSBOT19GSUxFO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlKCkge1xyXG4gICAgdGhpcy5jbGVhcigpO1xyXG4gICAgdGhpcy5lbWl0RmlsZXMoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZW1pdEZpbGVzKGRyb3BwZWRGaWxlcz8pIHtcclxuICAgIGNvbnN0IGZpbGVzID0gZHJvcHBlZEZpbGVzIHx8ICh0aGlzLmdvb2dsZUZpbGUgPyBbdGhpcy5nb29nbGVGaWxlXSA6IHRoaXMuZ2V0RmlsZXMoKSk7XHJcbiAgICB0aGlzLmZpbGVzLmVtaXQoeyBmaWxlczogZmlsZXMgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEZpbGVJbnB1dCgpIHtcclxuICAgIHJldHVybiB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RmlsZXMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRGaWxlSW5wdXQoKS5maWxlcztcclxuICB9XHJcbn1cclxuIl19