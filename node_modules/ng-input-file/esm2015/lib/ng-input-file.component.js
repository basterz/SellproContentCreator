/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { FormControl } from '@angular/forms';
import { GoogleDriveService } from './google-drive.service';
/** @type {?} */
const NO_FILE = '';
/** @type {?} */
const ACCEPT_DEFAULT = 'image/*, video/*';
export class NgInputFileComponent {
    // nativeElement
    /**
     * @param {?} service
     */
    constructor(service) {
        this.service = service;
        this.file = new FormControl({ value: NO_FILE, disabled: true });
        this.accept = ACCEPT_DEFAULT;
        this.files = new EventEmitter();
        this.service.selectedFile.subscribe((/**
         * @param {?} file
         * @return {?}
         */
        file => this.googleFileChanged(file)));
        this.drop = this.drop.bind(this);
        this.fileDropped = this.fileDropped.bind(this);
    }
    /**
     * @return {?}
     */
    get filename() { return this.file.value; }
    /**
     * @param {?} value
     * @return {?}
     */
    set filename(value) { this.file.setValue(value); }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.dropbox) {
            this.dropbox.addEventListener('dragenter', this.dragenter, false);
            this.dropbox.addEventListener('dragover', this.dragover, false);
            this.dropbox.addEventListener('drop', this.drop, false);
        }
        this.service.log('NgInputFileComponent', this.dropbox);
    }
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    dragenter(e) {
        e.stopPropagation();
        e.preventDefault();
    }
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    dragover(e) {
        e.stopPropagation();
        e.preventDefault();
    }
    /**
     * @private
     * @param {?} e
     * @return {?}
     */
    drop(e) {
        e.stopPropagation();
        e.preventDefault();
        /** @type {?} */
        var dt = e.dataTransfer;
        /** @type {?} */
        var files = dt.files;
        this.fileDropped(files);
    }
    /**
     * @private
     * @param {?} files
     * @return {?}
     */
    fileDropped(files) {
        if (!files || files.length === 0)
            return;
        /** @type {?} */
        const file = files.item(0);
        this.service.log(`fileDropped '${file.name}'`, file);
        if (this.filename === file.name)
            return;
        // got new file drag-and-dropped from local device
        this.filename = file.name;
        this.googleFile = null;
        this.emitFiles(files);
    }
    /**
     * @return {?}
     */
    fileChanged() {
        /** @type {?} */
        let filename = NO_FILE;
        if (this.getFiles().length > 0) {
            /** @type {?} */
            const file = this.getFiles().item(0);
            if (file)
                filename = file.name;
        }
        if (this.filename === filename)
            return;
        // got new file chosen from local device
        this.filename = filename;
        this.googleFile = null;
        this.emitFiles();
    }
    /**
     * @param {?} file
     * @return {?}
     */
    googleFileChanged(file) {
        this.service.log(`googleFileChanged '${file.name}'`, file);
        if (this.googleFile &&
            this.googleFile.name === file.name &&
            this.googleFile.size === file.size)
            return;
        // got new file from google drive
        this.filename = file.name;
        this.googleFile = file;
        this.emitFiles();
    }
    /**
     * @return {?}
     */
    googleDrivePick() {
        this.service.loadScript()
            .then((/**
         * @param {?} data
         * @return {?}
         */
        data => this.service.loadPicker()))
            .catch((/**
         * @param {?} error
         * @return {?}
         */
        error => console.error('googleDrivePick', error)));
    }
    /**
     * @return {?}
     */
    clear() {
        this.getFileInput().value = NO_FILE;
        this.googleFile = null;
        this.filename = NO_FILE;
    }
    /**
     * @return {?}
     */
    remove() {
        this.clear();
        this.emitFiles();
    }
    /**
     * @private
     * @param {?=} droppedFiles
     * @return {?}
     */
    emitFiles(droppedFiles) {
        /** @type {?} */
        const files = droppedFiles || (this.googleFile ? [this.googleFile] : this.getFiles());
        this.files.emit({ files: files });
    }
    /**
     * @private
     * @return {?}
     */
    getFileInput() {
        return this.inputEl.nativeElement;
    }
    /**
     * @private
     * @return {?}
     */
    getFiles() {
        return this.getFileInput().files;
    }
}
NgInputFileComponent.decorators = [
    { type: Component, args: [{
                selector: 'input-file',
                template: `
<div class="box">
  <div class="input-file" style="width:93%">
    <mat-form-field style="width:100%" (click)="inputEl.click()">
      <i matPrefix>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M2 12.5C2 9.46 4.46 7 7.5 7H18c2.21 0 4 1.79 4 4s-1.79 4-4 4H9.5C8.12 15 7 13.88 7 12.5S8.12 10 9.5 10H17v2H9.41c-.55 0-.55 1 0 1H18c1.1 0 2-.9 2-2s-.9-2-2-2H7.5C5.57 9 4 10.57 4 12.5S5.57 16 7.5 16H17v2H7.5C4.46 18 2 15.54 2 12.5z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>
      </i>
      <input matInput placeholder="Choose file" [formControl]="file">
    </mat-form-field>
    <input type="file" [attr.accept]="accept" (change)="fileChanged()" #inputEl>
  </div>
  <i class="icon" *ngIf="service.config" (click)="googleDrivePick()">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 48 48" version="1.1" width="24px" height="24px"><g id="surface1"><path style=" fill:#FFC107;" d="M 17 6 L 31 6 L 45 30 L 31 30 Z "/><path style=" fill:#1976D2;" d="M 9.875 42 L 16.9375 30 L 45 30 L 38 42 Z "/><path style=" fill:#4CAF50;" d="M 3 30.125 L 9.875 42 L 24 18 L 17 6 Z "/></g></svg>
  </i>
  <i class="icon" *ngIf="filename" (click)="remove()">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4z"/><path fill="none" d="M0 0h24v24H0V0z"/></svg>
  </i>
</div>
  `,
                styles: [`
.box {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
mat-form-field, i.icon {
  cursor: pointer;
}
input[type=file] {
  display: none;
}
i[matPrefix] {
  padding-right: 5px;
}
i.icon {
  padding-bottom: 12px;
}
  `]
            }] }
];
/** @nocollapse */
NgInputFileComponent.ctorParameters = () => [
    { type: GoogleDriveService }
];
NgInputFileComponent.propDecorators = {
    accept: [{ type: Input }],
    files: [{ type: Output }],
    inputEl: [{ type: ViewChild, args: ['inputEl',] }],
    dropbox: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    NgInputFileComponent.prototype.file;
    /** @type {?} */
    NgInputFileComponent.prototype.accept;
    /** @type {?} */
    NgInputFileComponent.prototype.files;
    /**
     * @type {?}
     * @private
     */
    NgInputFileComponent.prototype.inputEl;
    /**
     * @type {?}
     * @private
     */
    NgInputFileComponent.prototype.googleFile;
    /** @type {?} */
    NgInputFileComponent.prototype.dropbox;
    /** @type {?} */
    NgInputFileComponent.prototype.service;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctaW5wdXQtZmlsZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1pbnB1dC1maWxlLyIsInNvdXJjZXMiOlsibGliL25nLWlucHV0LWZpbGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdEcsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDOztNQUV0RCxPQUFPLEdBQUcsRUFBRTs7TUFDWixjQUFjLEdBQUcsa0JBQWtCO0FBMkN6QyxNQUFNLE9BQU8sb0JBQW9COzs7OztJQWEvQixZQUFtQixPQUEyQjtRQUEzQixZQUFPLEdBQVAsT0FBTyxDQUFvQjtRQVo5QyxTQUFJLEdBQUcsSUFBSSxXQUFXLENBQUMsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBSWhELFdBQU0sR0FBRyxjQUFjLENBQUM7UUFDdkIsVUFBSyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBUXRELElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLFNBQVM7Ozs7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDO1FBRTFFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqRCxDQUFDOzs7O0lBaEJELElBQUksUUFBUSxLQUFLLE9BQU8sSUFBSSxD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RixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7Ozs7O0lBRU8sWUFBWTtRQUNsQixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDO0lBQ3BDLENBQUM7Ozs7O0lBRU8sUUFBUTtRQUNkLE9BQU8sSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLEtBQUssQ0FBQztJQUNuQyxDQUFDOzs7WUFuS0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxZQUFZO2dCQUN0QixRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQWtCVDt5QkFDUTs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBa0JSO2FBQ0Y7Ozs7WUE3Q1Esa0JBQWtCOzs7cUJBbUR4QixLQUFLO29CQUNMLE1BQU07c0JBQ04sU0FBUyxTQUFDLFNBQVM7c0JBSW5CLEtBQUs7Ozs7SUFWTixvQ0FBeUQ7O0lBSXpELHNDQUFpQzs7SUFDakMscUNBQXdEOzs7OztJQUN4RCx1Q0FDNEI7Ozs7O0lBQzVCLDBDQUF5Qjs7SUFFekIsdUNBQXNCOztJQUVWLHVDQUFrQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgR29vZ2xlRHJpdmVTZXJ2aWNlIH0gZnJvbSAnLi9nb29nbGUtZHJpdmUuc2VydmljZSc7XHJcblxyXG5jb25zdCBOT19GSUxFID0gJyc7XHJcbmNvbnN0IEFDQ0VQVF9ERUZBVUxUID0gJ2ltYWdlLyosIHZpZGVvLyonO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdpbnB1dC1maWxlJyxcclxuICB0ZW1wbGF0ZTogYFxyXG48ZGl2IGNsYXNzPVwiYm94XCI+XHJcbiAgPGRpdiBjbGFzcz1cImlucHV0LWZpbGVcIiBzdHlsZT1cIndpZHRoOjkzJVwiPlxyXG4gICAgPG1hdC1mb3JtLWZpZWxkIHN0eWxlPVwid2lkdGg6MTAwJVwiIChjbGljayk9XCJpbnB1dEVsLmNsaWNrKClcIj5cclxuICAgICAgPGkgbWF0UHJlZml4PlxyXG4gICAgICAgIDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMjRcIiBoZWlnaHQ9XCIyNFwiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIj48cGF0aCBkPVwiTTIgMTIuNUMyIDkuNDYgNC40NiA3IDcuNSA3SDE4YzIuMjEgMCA0IDEuNzkgNCA0cy0xLjc5IDQtNCA0SDkuNUM4LjEyIDE1IDcgMTMuODggNyAxMi41UzguMTIgMTAgOS41IDEwSDE3djJIOS40MWMtLjU1IDAtLjU1IDEgMCAxSDE4YzEuMSAwIDItLjkgMi0ycy0uOS0yLTItMkg3LjVDNS41NyA5IDQgMTAuNTcgNCAxMi41UzUuNTcgMTYgNy41IDE2SDE3djJINy41QzQuNDYgMTggMiAxNS41NCAyIDEyLjV6XCIvPjxwYXRoIGZpbGw9XCJub25lXCIgZD1cIk0wIDBoMjR2MjRIMFYwelwiLz48L3N2Zz5cclxuICAgICAgPC9pPlxyXG4gICAgICA8aW5wdXQgbWF0SW5wdXQgcGxhY2Vob2xkZXI9XCJDaG9vc2UgZmlsZVwiIFtmb3JtQ29udHJvbF09XCJmaWxlXCI+XHJcbiAgICA8L21hdC1mb3JtLWZpZWxkPlxyXG4gICAgPGlucHV0IHR5cGU9XCJmaWxlXCIgW2F0dHIuYWNjZXB0XT1cImFjY2VwdFwiIChjaGFuZ2UpPVwiZmlsZUNoYW5nZWQoKVwiICNpbnB1dEVsPlxyXG4gIDwvZGl2PlxyXG4gIDxpIGNsYXNzPVwiaWNvblwiICpuZ0lmPVwic2VydmljZS5jb25maWdcIiAoY2xpY2spPVwiZ29vZ2xlRHJpdmVQaWNrKClcIj5cclxuICAgIDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHhtbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiIHZpZXdCb3g9XCIwIDAgNDggNDhcIiB2ZXJzaW9uPVwiMS4xXCIgd2lkdGg9XCIyNHB4XCIgaGVpZ2h0PVwiMjRweFwiPjxnIGlkPVwic3VyZmFjZTFcIj48cGF0aCBzdHlsZT1cIiBmaWxsOiNGRkMxMDc7XCIgZD1cIk0gMTcgNiBMIDMxIDYgTCA0NSAzMCBMIDMxIDMwIFogXCIvPjxwYXRoIHN0eWxlPVwiIGZpbGw6IzE5NzZEMjtcIiBkPVwiTSA5Ljg3NSA0MiBMIDE2LjkzNzUgMzAgTCA0NSAzMCBMIDM4IDQyIFogXCIvPjxwYXRoIHN0eWxlPVwiIGZpbGw6IzRDQUY1MDtcIiBkPVwiTSAzIDMwLjEyNSBMIDkuODc1IDQyIEwgMjQgMTggTCAxNyA2IFogXCIvPjwvZz48L3N2Zz5cclxuICA8L2k+XHJcbiAgPGkgY2xhc3M9XCJpY29uXCIgKm5nSWY9XCJmaWxlbmFtZVwiIChjbGljayk9XCJyZW1vdmUoKVwiPlxyXG4gICAgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIyNFwiIGhlaWdodD1cIjI0XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiPjxwYXRoIGQ9XCJNNiAxOWMwIDEuMS45IDIgMiAyaDhjMS4xIDAgMi0uOSAyLTJWN0g2djEyek04IDloOHYxMEg4Vjl6bTcuNS01bC0xLTFoLTVsLTEgMUg1djJoMTRWNHpcIi8+PHBhdGggZmlsbD1cIm5vbmVcIiBkPVwiTTAgMGgyNHYyNEgwVjB6XCIvPjwvc3ZnPlxyXG4gIDwvaT5cclxuPC9kaXY+XHJcbiAgYCxcclxuICBzdHlsZXM6IFtgXHJcbi5ib3gge1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcclxuICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47XHJcbn1cclxubWF0LWZvcm0tZmllbGQsIGkuaWNvbiB7XHJcbiAgY3Vyc29yOiBwb2ludGVyO1xyXG59XHJcbmlucHV0W3R5cGU9ZmlsZV0ge1xyXG4gIGRpc3BsYXk6IG5vbmU7XHJcbn1cclxuaVttYXRQcmVmaXhdIHtcclxuICBwYWRkaW5nLXJpZ2h0OiA1cHg7XHJcbn1cclxuaS5pY29uIHtcclxuICBwYWRkaW5nLWJvdHRvbTogMTJweDtcclxufVxyXG4gIGBdLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgTmdJbnB1dEZpbGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIGZpbGUgPSBuZXcgRm9ybUNvbnRyb2woe3ZhbHVlOiBOT19GSUxFLCBkaXNhYmxlZDogdHJ1ZX0pO1xyXG4gIGdldCBmaWxlbmFtZSgpIHsgcmV0dXJuIHRoaXMuZmlsZS52YWx1ZTsgfVxyXG4gIHNldCBmaWxlbmFtZSh2YWx1ZSkgeyB0aGlzLmZpbGUuc2V0VmFsdWUodmFsdWUpOyB9XHJcblxyXG4gIEBJbnB1dCgpIGFjY2VwdCA9IEFDQ0VQVF9ERUZBVUxUO1xyXG4gIEBPdXRwdXQoKSBmaWxlczogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQFZpZXdDaGlsZCgnaW5wdXRFbCcpXHJcbiAgcHJpdmF0ZSBpbnB1dEVsOiBFbGVtZW50UmVmO1xyXG4gIHByaXZhdGUgZ29vZ2xlRmlsZTogRmlsZTtcclxuXHJcbiAgQElucHV0KCkgZHJvcGJveDogYW55OyAvLyBuYXRpdmVFbGVtZW50XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBzZXJ2aWNlOiBHb29nbGVEcml2ZVNlcnZpY2UpIHtcclxuICAgIHRoaXMuc2VydmljZS5zZWxlY3RlZEZpbGUuc3Vic2NyaWJlKGZpbGUgPT4gdGhpcy5nb29nbGVGaWxlQ2hhbmdlZChmaWxlKSk7XHJcblxyXG4gICAgdGhpcy5kcm9wID0gdGhpcy5kcm9wLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmZpbGVEcm9wcGVkID0gdGhpcy5maWxlRHJvcHBlZC5iaW5kKHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBpZiAodGhpcy5kcm9wYm94KSB7XHJcbiAgICAgIHRoaXMuZHJvcGJveC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW50ZXInLCB0aGlzLmRyYWdlbnRlciwgZmFsc2UpO1xyXG4gICAgICB0aGlzLmRyb3Bib3guYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdvdmVyLCBmYWxzZSk7XHJcbiAgICAgIHRoaXMuZHJvcGJveC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcm9wLCBmYWxzZSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNlcnZpY2UubG9nKCdOZ0lucHV0RmlsZUNvbXBvbmVudCcsIHRoaXMuZHJvcGJveCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRyYWdlbnRlcihlKSB7XHJcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkcmFnb3ZlcihlKSB7XHJcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkcm9wKGUpIHtcclxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgdmFyIGR0ID0gZS5kYXRhVHJhbnNmZXI7XHJcbiAgICB2YXIgZmlsZXMgPSBkdC5maWxlcztcclxuXHJcbiAgICB0aGlzLmZpbGVEcm9wcGVkKGZpbGVzKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZmlsZURyb3BwZWQoZmlsZXMpIHtcclxuICAgIGlmICghZmlsZXMgfHwgZmlsZXMubGVuZ3RoID09PSAwKSByZXR1cm47XHJcblxyXG4gICAgY29uc3QgZmlsZSA9IGZpbGVzLml0ZW0oMCk7XHJcblxyXG4gICAgdGhpcy5zZXJ2aWNlLmxvZyhgZmlsZURyb3BwZWQgJyR7ZmlsZS5uYW1lfSdgLCBmaWxlKTtcclxuXHJcbiAgICBpZiAodGhpcy5maWxlbmFtZSA9PT0gZmlsZS5uYW1lKSByZXR1cm47XHJcblxyXG4gICAgLy8gZ290IG5ldyBmaWxlIGRyYWctYW5kLWRyb3BwZWQgZnJvbSBsb2NhbCBkZXZpY2VcclxuICAgIHRoaXMuZmlsZW5hbWUgPSBmaWxlLm5hbWU7XHJcbiAgICB0aGlzLmdvb2dsZUZpbGUgPSBudWxsO1xyXG4gICAgdGhpcy5lbWl0RmlsZXMoZmlsZXMpO1xyXG4gIH1cclxuXHJcblxyXG4gIGZpbGVDaGFuZ2VkKCkge1xyXG4gICAgbGV0IGZpbGVuYW1lID0gTk9fRklMRTtcclxuICAgIGlmICh0aGlzLmdldEZpbGVzKCkubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5nZXRGaWxlcygpLml0ZW0oMCk7XHJcbiAgICAgIGlmIChmaWxlKSBmaWxlbmFtZSA9IGZpbGUubmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5maWxlbmFtZSA9PT0gZmlsZW5hbWUpIHJldHVybjtcclxuXHJcbiAgICAvLyBnb3QgbmV3IGZpbGUgY2hvc2VuIGZyb20gbG9jYWwgZGV2aWNlXHJcbiAgICB0aGlzLmZpbGVuYW1lID0gZmlsZW5hbWU7XHJcbiAgICB0aGlzLmdvb2dsZUZpbGUgPSBudWxsO1xyXG4gICAgdGhpcy5lbWl0RmlsZXMoKTtcclxuICB9XHJcblxyXG4gIGdvb2dsZUZpbGVDaGFuZ2VkKGZpbGUpIHtcclxuICAgIHRoaXMuc2VydmljZS5sb2coYGdvb2dsZUZpbGVDaGFuZ2VkICcke2ZpbGUubmFtZX0nYCwgZmlsZSk7XHJcblxyXG4gICAgaWYgKHRoaXMuZ29vZ2xlRmlsZSAmJlxyXG4gICAgICB0aGlzLmdvb2dsZUZpbGUubmFtZSA9PT0gZmlsZS5uYW1lICYmXHJcbiAgICAgIHRoaXMuZ29vZ2xlRmlsZS5zaXplID09PSBmaWxlLnNpemUpXHJcbiAgICAgIHJldHVybjtcclxuXHJcbiAgICAvLyBnb3QgbmV3IGZpbGUgZnJvbSBnb29nbGUgZHJpdmVcclxuICAgIHRoaXMuZmlsZW5hbWUgPSBmaWxlLm5hbWU7XHJcbiAgICB0aGlzLmdvb2dsZUZpbGUgPSBmaWxlO1xyXG4gICAgdGhpcy5lbWl0RmlsZXMoKTtcclxuICB9XHJcblxyXG4gIGdvb2dsZURyaXZlUGljaygpIHtcclxuICAgIHRoaXMuc2VydmljZS5sb2FkU2NyaXB0KClcclxuICAgICAgLnRoZW4oZGF0YSA9PiB0aGlzLnNlcnZpY2UubG9hZFBpY2tlcigpKVxyXG4gICAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5lcnJvcignZ29vZ2xlRHJpdmVQaWNrJywgZXJyb3IpKTtcclxuICB9XHJcblxyXG4gIGNsZWFyKCkge1xyXG4gICAgdGhpcy5nZXRGaWxlSW5wdXQoKS52YWx1ZSA9IE5PX0ZJTEU7XHJcbiAgICB0aGlzLmdvb2dsZUZpbGUgPSBudWxsO1xyXG4gICAgdGhpcy5maWxlbmFtZSA9IE5PX0ZJTEU7XHJcbiAgfVxyXG5cclxuICByZW1vdmUoKSB7XHJcbiAgICB0aGlzLmNsZWFyKCk7XHJcbiAgICB0aGlzLmVtaXRGaWxlcygpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBlbWl0RmlsZXMoZHJvcHBlZEZpbGVzPykge1xyXG4gICAgY29uc3QgZmlsZXMgPSBkcm9wcGVkRmlsZXMgfHwgKHRoaXMuZ29vZ2xlRmlsZSA/IFt0aGlzLmdvb2dsZUZpbGVdIDogdGhpcy5nZXRGaWxlcygpKTtcclxuICAgIHRoaXMuZmlsZXMuZW1pdCh7IGZpbGVzOiBmaWxlcyB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RmlsZUlucHV0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRGaWxlcygpIHtcclxuICAgIHJldHVybiB0aGlzLmdldEZpbGVJbnB1dCgpLmZpbGVzO1xyXG4gIH1cclxufVxyXG4iXX0=